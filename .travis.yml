language: ruby
os: linux
dist: focal
cache:
  - bundler
rvm:
  - 2.7.1
gemfile:
  - Gemfile
services:
  - postgresql
addons:
  postgresql: "12.2"
before_script:
 - bundle exec rake db:create RAILS_ENV=test
 - bundle exec rake db:schema:load RAILS_ENV=test
 - bundle exec rake db:seed RAILS_ENV=test
cache:
  bundler: true
  directories:
    - node_modules
  yarn: true
install:
  - bundle install
  - nvm install node
  - node -v
  - npm i -g yarn
  - yarn
script:
 - bundle exec rails webpacker:compile  
 - bundle exec rspec
